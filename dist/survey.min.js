/*! simple-survey - v0.0.2 - 2014-05-20
* Copyright (c) 2014 ; Licensed  */
var simpleSurvey=function(a,b){var c={method:"POST",url:window.location.href,submitText:"Submit",warningText:"Required"},d=function(){for(var a,b,c,d=arguments[0]||{},e=1,f=arguments.length;f>e;e++)if(null!=(a=arguments[e]))for(b in a)a.hasOwnProperty(b)&&(c=a[b],d===c||void 0!==c&&(d[b]=c));return d};return new simpleSurvey.fn(a,d(c,b))};simpleSurvey.fn=function(a,b){var c=this,d={},e=document.createElement("div"),f=document.createElement("input"),g=document.createElement("form"),h=document.querySelector(a),i=g.cloneNode(),j=b.list,k=b.list.length,l=[];if(c.option=b,!h)throw new Error("Cant find matched elements");var m=function(a,b){var c;c=b.default?b.multi?[b.default]:b.default:b.multi?[]:"",a.addEventListener("click",function(a){"survey-input-wrap"==a.target.className&&a.target.querySelector(".survey-input").click()},!0);var d=function(d){if(-1!=d.target.className.indexOf("survey-input")){if(a.querySelector(".survey-warning").innerHTML="","text"==b.type||"textarea"==b.type)c=a.querySelector(".survey-input").value;else{var e=a.querySelectorAll(":checked");c=[];for(var f=0,g=e.length;g>f;f++){var h;h="string"!=typeof b.selects[e[f].value]?e[f].parentNode.querySelector("input[type="+b.selects[e[f].value].type||"text]").value:e[f].value,b.multi?c.push(h):c=h}}b.onChange&&b.onChange(d,c)}},e=!1,f=function(c,d){return b.onError&&(b.onError(c),e)?void(e=!1):void(a.querySelector(".survey-warning").innerHTML=d)};a.addEventListener("change",d,!1);var g=function(){return c},h=function(){e=!0};return{id:b.id,list:b,itemDom:a,getValue:g,onChangeHandle:d,preventDefault:h,onError:f}};if(i.className="survey-wrap",i.setAttribute("method",b.method),i.setAttribute("action",b.url),b.mainTitle){var n=e.cloneNode();n.className="survey-title",n.innerHTML=b.mainTitle||"",i.appendChild(n)}if(b.subTitle){var o=e.cloneNode();o.className="survey-subtitle",o.innerHTML=b.subTitle||"",i.appendChild(o)}for(var p=0;k>p;p++){var q=e.cloneNode(!1),r=e.cloneNode(!1),s=e.cloneNode(!1),t=j[p];if(q.className="survey-item",r.innerHTML=j[p].text,r.className="survey-item-title",s.className="survey-warning",q.appendChild(r),q.appendChild(s),!t.id)throw new Error("id missed");var u,v;if("text"==t.type||"textarea"==t.type)u=e.cloneNode(),"text"==t.type?(v=f.cloneNode(),v.type=t.type):v=document.createElement("textarea"),u.className="survey-input-wrap",v.className="survey-input",v.name=t.id,t.default&&(v.value=t.default),u.appendChild(v),q.appendChild(u);else{if(!t.selects)throw new Error("The item "+t.id+"missed selects or type");for(var w in t.selects)if(t.selects.hasOwnProperty(w)){if(u=e.cloneNode(),v=f.cloneNode(),u.className="survey-input-wrap",v.className="survey-input",v.name=t.id,v.type=t.multi?"checkbox":"radio",v.value=w,u.appendChild(v),t.selects[w].text){var x=f.cloneNode();x.type=t.selects[w].type||"text",x.className="survey-input",u.insertBefore(x,v.nextSibling),u.insertBefore(document.createTextNode(t.selects[w].text),v.nextSibling)}else u.insertBefore(document.createTextNode(t.selects[w]),v.nextSibling);q.appendChild(u)}if(t.default)if("string"==typeof t.default)q.querySelector("[value="+t.default+"]").click();else if(t.default.length)for(p=0;p<t.default.length;p++)q.querySelector("[value="+t.default[p]+"]").click()}if(t.after){var y=e.cloneNode();y.className="survey-input-after",y.innerHTML=t.after,q.appendChild(y)}l[p]=m(q,t),i.appendChild(q)}var z=f.cloneNode();if(z.setAttribute("type","submit"),z.className="survey-submit",z.setAttribute("value",b.submitText),b.onSubmit)var A=function(a){for(var c=0;c<l.length;c++)if(d[l[c].id]=l[c].getValue(),(""==l[c].getValue()||l[c].getValue()==[])&&!l[c].list.optional)return a.preventDefault(),l[c].onError(l[c],b.warningText),void b.onError(l[c],b.warningText);b.onSubmit(a,d)};i.addEventListener("submit",A,!1),i.appendChild(z),h.appendChild(i)};