/*! simple-survey - v0.0.1 - 2014-03-12
* Copyright (c) 2014 ; Licensed  */
var simpleSurvey=function(a,b){var c={method:"POST",url:window.location.href,submitText:"Submit",warningText:"Required"},d=function(){for(var a,b,c,d=arguments[0]||{},e=1,f=arguments.length;f>e;e++)if(null!=(a=arguments[e]))for(b in a)c=a[b],d!==c&&void 0!==c&&(d[b]=c);return d};return new simpleSurvey.fn(a,d(c,b))};simpleSurvey.fn=function(a,b){var c=this,d={},e=document.createElement("div"),f=document.createElement("input"),g=document.createElement("form"),h=document.querySelector(a),i=g.cloneNode(),j=b.list,k=b.list.length,l=0,m=[];if(c.option=b,!h)throw new Error("Cant find matched elements");var n=function(a,b){var c=b.multi?[]:"",d=[],d=function(d){if(-1!=d.target.className.indexOf("survey-input")){if(a.querySelector(".survey-warning").innerHTML="","text"==b.type||"textarea"==b.type)c=a.querySelector(".survey-input").value;else{var e=a.querySelectorAll(":checked");c=[];for(var f=0,g=e.length;g>f;f++){var h;h="string"!=typeof b.selects[e[f].value]?e[f].parentNode.querySelector("input[type="+b.selects[e[f].value].type||"text]").value:e[f].value,b.multi?c.push(h):c=h}}b.onChange&&b.onChange(d,c)}},e=!1,f=function(c,d){return b.onError&&(b.onError(c),e)?void(e=!1):void(a.querySelector(".survey-warning").innerHTML=d)};a.addEventListener("change",d,!1);var g=function(){return c},h=function(){e=!0};return{id:b.id,list:b,itemDom:a,getValue:g,onChangeHandle:d,preventDefault:h,onError:f}};if(i.className="survey-wrap",i.setAttribute("method",b.method),i.setAttribute("action",b.url),b.mainTitle){var o=e.cloneNode();o.className="survey-title",o.innerHTML=b.mainTitle||"",i.appendChild(o)}if(b.subTitle){var p=e.cloneNode();p.className="survey-subtitle",p.innerHTML=b.subTitle||"",i.appendChild(p)}for(;k>l;l++){var q=e.cloneNode(),r=e.cloneNode(),s=e.cloneNode(),t=j[l];if(q.className="survey-item",r.innerHTML=j[l].text,r.className="survey-item-title",s.className="survey-warning",q.appendChild(r),q.appendChild(s),!t.id)throw new Error("id missed");if("text"==t.type||"textarea"==t.type){var u,v=e.cloneNode();"text"==t.type?(u=f.cloneNode(),u.type=t.type):u=document.createElement("textarea"),v.className="survey-input-wrap",u.className="survey-input",u.name=t.id,v.appendChild(u),q.appendChild(v)}else{if(!t.selects)throw new Error("The item "+t.id+"missed selects or type");for(var w in t.selects){var v=e.cloneNode(),u=f.cloneNode();if(v.className="survey-input-wrap",u.className="survey-input",u.name=t.id,u.type=t.multi?"checkbox":"radio",u.value=w,v.appendChild(u),t.selects[w].text){var x=f.cloneNode();x.type=t.selects[w].type||"text",x.className="survey-input",v.insertBefore(x,u.nextSibling),v.insertBefore(document.createTextNode(t.selects[w].text),u.nextSibling)}else v.insertBefore(document.createTextNode(t.selects[w]),u.nextSibling);q.appendChild(v)}}m[l]=n(q,t),i.appendChild(q)}var y=f.cloneNode();if(y.setAttribute("type","submit"),y.className="survey-submit",y.setAttribute("value",b.submitText),b.onSubmit)var z=function(a){for(var c=0;c<m.length;c++)if(d[m[c].id]=m[c].getValue(),(""==m[c].getValue()||m[c].getValue()==[])&&!m[c].list.optional)return a.preventDefault(),m[c].onError(m[c],b.warningText),void b.onError(m[c],b.warningText);b.onSubmit(a,d)};i.addEventListener("submit",z,!1),i.appendChild(y),h.appendChild(i)};